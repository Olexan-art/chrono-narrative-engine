# üîß entity_views - –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –∑–±–æ—Ä—É –¥–∞–Ω–∏—Ö

## üîç –ü—Ä–æ–±–ª–µ–º–∞ —â–æ –≤–∏—è–≤–ª–µ–Ω–æ:

–¢–∞–±–ª–∏—Ü—è `entity_views` **—Å—Ç–≤–æ—Ä–µ–Ω–∞**, –∞–ª–µ **–¥–∞–Ω—ñ –Ω–µ –∑–±–∏—Ä–∞—é—Ç—å—Å—è** ‚ùå

### –ü—Ä–∏—á–∏–Ω–∞:
–§—É–Ω–∫—Ü—ñ—è `track-view` –ù–ï –∑–∞–ø–∏—Å—É—î —É `entity_views` - –≤–æ–Ω–∞ –∑–∞–ø–∏—Å—É—î —Ç—ñ–ª—å–∫–∏:
- ‚úÖ `view_counts` - –∞–≥—Ä–µ–≥–æ–≤–∞–Ω—ñ –ª—ñ—á–∏–ª—å–Ω–∏–∫–∏
- ‚úÖ `daily_views` - –ø–æ–≥–æ–¥–∏–Ω–Ω—ñ –¥–∞–Ω—ñ  
- ‚úÖ `view_visitors` - —É–Ω—ñ–∫–∞–ª—å–Ω—ñ –≤—ñ–¥–≤—ñ–¥—É–≤–∞—á—ñ

## ‚úÖ –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –∑–∞—Å—Ç–æ—Å–æ–≤–∞–Ω–æ:

### 1. –û–Ω–æ–≤–ª–µ–Ω–æ `track-view/index.ts`
–î–æ–¥–∞–Ω–æ –ª–æ–≥—É–≤–∞–Ω–Ω—è –ö–û–ñ–ù–û–ì–û –ø–µ—Ä–µ–≥–ª—è–¥—É:
```typescript
// Log each view to entity_views for detailed analytics
try {
  await supabase
    .from('entity_views')
    .insert({
      entity_type: entityType,
      entity_id: entityId,
      visitor_id: visitorId
    });
} catch (err) {
  console.error('entity_views logging failed:', err);
}
```

### 2. –ü–æ—Ç—Ä—ñ–±–Ω–æ –¥–µ–ø–ª–æ—ó—Ç–∏ —Ñ—É–Ω–∫—Ü—ñ—é

**‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ù–û:** Docker Desktop –Ω–µ –∑–∞–ø—É—â–µ–Ω–∏–π!

## üìù –Ø–∫ –∑–∞–≤–µ—Ä—à–∏—Ç–∏ –¥–µ–ø–ª–æ–π:

### –í–∞—Ä—ñ–∞–Ω—Ç 1: –ó–∞–ø—É—Å—Ç–∏—Ç–∏ Docker —ñ –¥–µ–ø–ª–æ—ó—Ç–∏
```powershell
# 1. –ó–∞–ø—É—Å—Ç–∏—Ç–∏ Docker Desktop
# 2. –í–∏–∫–æ–Ω–∞—Ç–∏ –¥–µ–ø–ª–æ–π
npx supabase functions deploy track-view --no-verify-jwt
```

### –í–∞—Ä—ñ–∞–Ω—Ç 2: –î–µ–ø–ª–æ–π —á–µ—Ä–µ–∑ Supabase Dashboard
1. –í—ñ–¥–∫—Ä–∏—Ç–∏: https://supabase.com/dashboard/project/tuledxqigzufkecztnlo/functions
2. –í—ñ–¥–∫—Ä–∏—Ç–∏ —Ñ—É–Ω–∫—Ü—ñ—é `track-view`
3. –ó–∞–º—ñ–Ω–∏—Ç–∏ –∫–æ–¥ –Ω–∞ –æ–Ω–æ–≤–ª–µ–Ω–∏–π –∑ `supabase/functions/track-view/index.ts`
4. –ù–∞—Ç–∏—Å–Ω—É—Ç–∏ **Deploy**

## üß™ –ü—ñ—Å–ª—è –¥–µ–ø–ª–æ—é - –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞:

### –¢–µ—Å—Ç 1: –í—ñ–¥–∫—Ä–∏–π—Ç–µ –Ω–æ–≤–∏–Ω–∏ –∞–±–æ wiki
```
http://localhost:8080/news
http://localhost:8080/wiki
```

### –¢–µ—Å—Ç 2: –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —á–∏ –∑'—è–≤–∏–ª–∏—Å—å –∑–∞–ø–∏—Å–∏
```powershell
# REST API –∑–∞–ø–∏—Ç
$headers = @{ "apikey" = "..."; "Authorization" = "Bearer ..." }
Invoke-RestMethod -Uri "https://tuledxqigzufkecztnlo.supabase.co/rest/v1/entity_views?select=count" -Headers $headers -Method HEAD
```

### –¢–µ—Å—Ç 3: –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ Dashboard
```
http://localhost:8080/admin ‚Üí Dashboard
```
–ì—Ä–∞—Ñ—ñ–∫ "–ü–µ—Ä–µ–≥–ª—è–¥–∏ –∑–∞ —Ç–∏–ø–æ–º (News/Wiki)" –ø–æ—á–Ω–µ –ø–æ–∫–∞–∑—É–≤–∞—Ç–∏ –¥–∞–Ω—ñ

## üìä –Ø–∫ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏–º–µ:

### –ü—Ä–∏ –∫–æ–∂–Ω–æ–º—É –ø–µ—Ä–µ–≥–ª—è–¥—ñ:
1. –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –≤—ñ–¥–∫—Ä–∏–≤–∞—î –Ω–æ–≤–∏–Ω—É/wiki
2. `useTrackView` hook –≤–∏–∫–ª–∏–∫–∞—î `track-view` —Ñ—É–Ω–∫—Ü—ñ—é
3. **–ù–û–í–û–ï:** –ó–∞–ø–∏—Å —É `entity_views` (–¥–µ—Ç–∞–ª—å–Ω–∏–π –ª–æ–≥)
4. –ó–∞–ø–∏—Å —É `daily_views` (–∞–≥—Ä–µ–≥–∞—Ü—ñ—è –ø–æ –¥–Ω—è—Ö)
5. –ó–∞–ø–∏—Å —É `view_visitors` (—É–Ω—ñ–∫–∞–ª—å–Ω—ñ)
6. –û–Ω–æ–≤–ª–µ–Ω–Ω—è `view_counts` (–∑–∞–≥–∞–ª—å–Ω—ñ –ª—ñ—á–∏–ª—å–Ω–∏–∫–∏)

### Dashboard –æ—Ç—Ä–∏–º—É—î:
- **entity_views:** –ü–æ–≥–æ–¥–∏–Ω–Ω—ñ –ø–µ—Ä–µ–≥–ª—è–¥–∏ News vs Wiki
- **view_visitors:** –£–Ω—ñ–∫–∞–ª—å–Ω—ñ –≤—ñ–¥–≤—ñ–¥—É–≤–∞—á—ñ
- **bot_visits:** –¢—Ä–∞—Ñ—ñ–∫ –≤—ñ–¥ –±–æ—Ç—ñ–≤

## üéØ –°—Ç–∞—Ç—É—Å:

- ‚úÖ –ú—ñ–≥—Ä–∞—Ü—ñ—è –ë–î –∑–∞—Å—Ç–æ—Å–æ–≤–∞–Ω–∞
- ‚úÖ –ö–æ–¥ track-view –æ–Ω–æ–≤–ª–µ–Ω–æ
- ‚è≥ **–ü–æ—Ç—Ä—ñ–±–Ω–æ:** –î–µ–ø–ª–æ–π track-view —Ñ—É–Ω–∫—Ü—ñ—ó
- ‚è≥ **–ó–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥:** Docker Desktop

---

**–§–∞–π–ª:** supabase/functions/track-view/index.ts  
**–û–Ω–æ–≤–ª–µ–Ω–æ:** 21.02.2026  
**–°—Ç–∞—Ç—É—Å:** –ì–æ—Ç–æ–≤–æ –¥–æ –¥–µ–ø–ª–æ—é
